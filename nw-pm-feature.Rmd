---
layout: page
title: xwMOOC 네트워크
subtitle: 네트워크 변수(Feature)
author:
    name: xwMOOC
    url: https://www.facebook.com/groups/tidyverse/
    affiliation: Tidyverse Korea
date: "`r Sys.Date()`"
output:
  html_document: 
    toc: yes
    toc_float: true
    highlight: tango
    code_folding: show
    number_section: true
    self_contained: true
editor_options: 
  chunk_output_type: console
---
 
``` {r, include=FALSE}
# source("tools/chunk-options.R")
knitr::opts_chunk$set(echo = TRUE, message=FALSE, warning=FALSE,
                      comment="", digits = 3, tidy = FALSE, prompt = FALSE, fig.align = 'center')
```

# 네트워크 Feature [^ruck-network-feature] {#r-network-feature}

[^ruck-network-feature]: [이은조 엔씨소프트(2018), "네트워크 분석 기법을 활용한 게임 데이터 분석", R User Conference in Korea 2018](http://ruck2018.r-kor.org/speakers/#1535826533174-e80c7017-8226)

# 사기(fraud) 데이터 [^kaggle-fraud-data] {#r-network-feature-fraud-data}

[^kaggle-fraud-data]: [Kaggle, "Synthetic Financial Datasets For Fraud Detection", Synthetic datasets generated by the PaySim mobile money simulator](https://www.kaggle.com/ntnu-testimon/paysim1/home)

- 데이터 사전(Data Dictionary)
    - step - maps a unit of time in the real world.
    - type - CASH-IN, CASH-OUT, DEBIT, PAYMENT and TRANSFER.
    - amount - amount of the transaction in local currency.
    - nameOrig - customer who started the transaction
    - oldbalanceOrg - initial balance before the transaction
    - newbalanceOrig - new balance after the transaction
    - nameDest - customer who is the recipient of the transaction
    - oldbalanceDest - initial balance recipient before the transaction.
    - newbalanceDest - new balance recipient after the transaction.
    - isFraud - This is the transactions made by the fraudulent agents inside the simulation.
    - isFlaggedFraud - The business model aims to control massive transfers from one account to another and flags illegal attempts.

```{r fraud-data}
library(tidyverse)
library(janitor)

dat <- read_csv("data/PS_20174392719_1491204439457_log.csv")

fraud_df <- dat %>% 
  clean_names() %>% 
  filter(type %in% c("CASH_OUT", "TRANSFER")) %>% 
  select(setdiff(names(.), c("is_flagged_fraud", "time"))) %>% 
  mutate(is_fraud = factor(is_fraud, levels = c(1, 0), labels = c("yes", "no")))

```

## $Y$ 사기 변수 {#r-network-feature-fraud-data-y}

```{r fraud-data}
fraud_df %>% 
  count(is_fraud) %>% 
  mutate(pcnt = n / sum(n)) %>% 
  DT::datatable() %>% 
    DT::formatRound("n", digits =0) %>% 
    DT::formatPercentage("pcnt", digits =3)

fraud_df %>% 
  count(is_fraud) %>% 
  mutate(pcnt = n / sum(n)) %>% 
  mutate(label = str_c("fraud: ", is_fraud, " \n", scales::percent(pcnt))) %>% 
  mutate(midpoint = c(0.99, 0.5)) %>% 
  ggplot(aes(x = 1, weight = pcnt, fill = is_fraud)) +
    scale_fill_manual(values = c("red", "lightgreen")) +
    geom_bar(width = 1, position = "stack") +
    coord_polar(theta = "y") +
    geom_text(aes(x = 1.1, y = midpoint, label = label)) +
    ggmap::theme_nothing()

```



